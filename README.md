# kubectl-ld

![CI](https://github.com/jeremyeder/kubectl-ld/workflows/CI/badge.svg)
![Tests](https://img.shields.io/badge/tests-53%20passing-green.svg)
![Coverage](https://img.shields.io/badge/coverage-comprehensive-green.svg)
![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.11+-blue.svg)
![Quality](https://img.shields.io/badge/code%20quality-production%20ready-green.svg)

`kubectl-ld` (LLM Debug) is a mock CLI tool for debugging and simulating `LLMInferenceService` CRDs in a Kubernetes-like environment â€” without requiring a live cluster. It's designed for SREs, ML engineers, and platform teams to simulate rollouts, test failure modes, and inspect the status of LLM-serving infrastructure offline.

> **Note**: This project was initially generated by ChatGPT but completely rewritten by Claude due to severe structural issues in the original code.

---

## ğŸš€ Features

- âœ… Offline simulation of up to 100 `LLMInferenceService` CRs
- âœ… Mock support for `LLMInferenceServiceConfig`
- âœ… Full CRUD support on mocked CRs
- âœ… Realistic rollout playback (`play rollout`)
- âœ… Live-style watch command (`watch`) to track CR status changes
- âœ… Log simulation for individual model services
- âœ… Configurable via file structure (`./mocks/`)

---

## ğŸ“¦ Structure

```
kubectl-ld/
â”œâ”€â”€ kubectl-ld                 # Python CLI entry point
â”œâ”€â”€ mocks/
â”‚   â”œâ”€â”€ crs/                   # LLMInferenceService CRs (20 included)
â”‚   â”œâ”€â”€ config/                # Global LLMInferenceServiceConfig mock
â”‚   â”œâ”€â”€ pod_logs/              # Simulated logs for LLMs
â”‚   â””â”€â”€ topologies/            # Rollout scenarios
```

---

## ğŸ›  Usage

```bash
chmod +x kubectl-ld
./kubectl-ld list                         # List all mocked LLMInferenceServices
./kubectl-ld check llm-005                # Inspect a specific CR
./kubectl-ld logs llm-005                 # View logs for a model
./kubectl-ld config                       # Show global LLM config
./kubectl-ld delete llm-005               # Delete a mock CR
./kubectl-ld create file.json             # Create CR from file
./kubectl-ld simulate canary              # Simulate canary rollout
```

---

## ğŸ¬ Rollout Simulation

```bash
./kubectl-ld simulate canary
./kubectl-ld simulate bluegreen
./kubectl-ld simulate rolling
./kubectl-ld simulate shadow
```

Watch rollouts with animation:

```bash
./watch_rollout.py --topology rolling --autoplay --delay 2
```

---

## ğŸŒ Live Cluster Support

`kubectl-ld` can operate in **live mode** using actual Kubernetes resources.

### ğŸ” Modes

| Mode   | Description                       |
|--------|-----------------------------------|
| `mock` | Use local files in `./mocks/`     |
| `live` | Use `kubectl` to talk to a cluster|

### ğŸ”§ Set the Mode

Via environment variable:

```bash
export LLD_MODE=live
./kubectl-ld list
```

Or per-command:

```bash
./kubectl-ld --mode live list
./kubectl-ld --mode mock list
```

---

## ğŸ§ª Development & Testing

**Requires: Python 3.11+**

The tool will check your Python version on startup and exit with an error if you're running an older version.

### Code Quality Features
- âœ… **Comprehensive Testing**: 53 tests including unit and integration tests
- âœ… **Type Hints**: Full type annotations for better IDE support
- âœ… **Security Scanning**: Automated vulnerability scanning with safety and bandit
- âœ… **Code Quality Gates**: Coverage thresholds and complexity checks
- âœ… **Dependency Management**: Automated updates with Dependabot
- âœ… **Error Handling**: Graceful error handling for all operations

### Running Tests
```bash
# Install test dependencies
pip install -r requirements.txt

# Run all tests
python3 -m pytest tests/ -v

# Run with coverage
python3 -m pytest tests/ --cov=. --cov-report=term
```

### Dependencies
See `requirements.txt` for pinned dependency versions with security scanning.

---

## Installation

### 1. Install Python dependencies

**Requirements: Python 3.11 or later**

```bash
# Check your Python version
python3 --version

# Install dependencies
pip install -r requirements.txt
```

### 2. Make executable

```bash
chmod +x kubectl-ld
```

### 3. Test installation

```bash
./kubectl-ld help
./kubectl-ld list
```

---

## ğŸ“œ License

MIT

---

## ğŸ¤ Contributing

Pull requests welcome for:
- Additional rollout topologies
- New simulation features
- Improved error handling
- Enhanced testing